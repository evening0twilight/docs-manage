# ç”¨æˆ·ä¿¡æ¯å­—æ®µè¯´æ˜

## ğŸ“‹ å®Œæ•´çš„ç”¨æˆ·å­—æ®µåˆ—è¡¨

### åŸºç¡€ä¿¡æ¯
| å­—æ®µå | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| `id` | number | âœ… | ç”¨æˆ·å”¯ä¸€æ ‡è¯† |
| `username` | string | âœ… | ç”¨æˆ·å(å”¯ä¸€,2-20å­—ç¬¦) |
| `email` | string | âœ… | é‚®ç®±(å”¯ä¸€) |
| `password` | string | âœ… | å¯†ç (åŠ å¯†å­˜å‚¨,ä¸è¿”å›ç»™å‰ç«¯) |

### ä¸ªäººèµ„æ–™
| å­—æ®µå | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| `avatar` | string | âŒ | å¤´åƒURL(é€šè¿‡è…¾è®¯äº‘COSå­˜å‚¨) |
| `displayName` | string | âŒ | æ˜µç§°/æ˜¾ç¤ºåç§°(æœ€å¤š100å­—ç¬¦) |
| `phone` | string | âŒ | æ‰‹æœºå·(æœ€å¤š20å­—ç¬¦) |
| `bio` | string | âŒ | ä¸ªäººç®€ä»‹(æœ€å¤š500å­—ç¬¦) |
| `location` | string | âŒ | æ‰€åœ¨åœ°(æœ€å¤š100å­—ç¬¦) |
| `website` | string | âŒ | ä¸ªäººç½‘ç«™(URLæ ¼å¼,æœ€å¤š200å­—ç¬¦) |
| `organization` | string | âŒ | å…¬å¸/ç»„ç»‡(æœ€å¤š100å­—ç¬¦) |
| `position` | string | âŒ | èŒä½(æœ€å¤š100å­—ç¬¦) |

### ç³»ç»Ÿå­—æ®µ
| å­—æ®µå | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| `isActive` | boolean | âœ… | è´¦å·æ˜¯å¦æ¿€æ´»(é»˜è®¤true) |
| `lastLoginAt` | Date | âŒ | æœ€åç™»å½•æ—¶é—´(è‡ªåŠ¨æ›´æ–°) |
| `createdAt` | Date | âœ… | åˆ›å»ºæ—¶é—´(è‡ªåŠ¨ç”Ÿæˆ) |
| `updatedAt` | Date | âœ… | æ›´æ–°æ—¶é—´(è‡ªåŠ¨æ›´æ–°) |

---

## ğŸ”Œ API æ¥å£

### 1. è·å–ç”¨æˆ·ä¿¡æ¯
```http
GET /api/users/profile
Authorization: Bearer <token>
```

**å“åº”ç¤ºä¾‹:**
```json
{
  "success": true,
  "data": {
    "id": 1,
    "username": "zhangsan",
    "email": "zhangsan@example.com",
    "avatar": "https://docs-manage-files-1352341719.cos.ap-guangzhou.myqcloud.com/avatars/abc-123.jpg",
    "displayName": "å¼ ä¸‰",
    "phone": "13800138000",
    "bio": "è¿™æ˜¯æˆ‘çš„ä¸ªäººç®€ä»‹",
    "location": "åŒ—äº¬",
    "website": "https://example.com",
    "organization": "æŸæŸå…¬å¸",
    "position": "å‰ç«¯å·¥ç¨‹å¸ˆ",
    "lastLoginAt": "2025-10-13T10:30:00.000Z",
    "createdAt": "2025-10-01T08:00:00.000Z",
    "updatedAt": "2025-10-13T10:30:00.000Z"
  },
  "message": "è·å–ç”¨æˆ·ä¿¡æ¯æˆåŠŸ"
}
```

---

### 2. æ›´æ–°ç”¨æˆ·ä¿¡æ¯
```http
PUT /api/users/profile
Authorization: Bearer <token>
Content-Type: application/json
```

**è¯·æ±‚ä½“:**
```json
{
  "displayName": "æå››",
  "phone": "13900139000",
  "bio": "å…¨æ ˆå¼€å‘å·¥ç¨‹å¸ˆ",
  "location": "ä¸Šæµ·",
  "website": "https://lisi.dev",
  "organization": "XXç§‘æŠ€æœ‰é™å…¬å¸",
  "position": "æŠ€æœ¯æ€»ç›‘"
}
```

**å“åº”:** åŒä¸Š(è¿”å›æ›´æ–°åçš„å®Œæ•´ç”¨æˆ·ä¿¡æ¯)

---

### 3. ä¸Šä¼ å¤´åƒ
```http
POST /api/users/avatar
Authorization: Bearer <token>
Content-Type: multipart/form-data
```

**è¯·æ±‚ä½“ (form-data):**
- Key: `file`
- Type: File
- Value: å›¾ç‰‡æ–‡ä»¶

**å“åº”:**
```json
{
  "success": true,
  "data": {
    "avatar": "https://docs-manage-files-1352341719.cos.ap-guangzhou.myqcloud.com/avatars/uuid-xxx.jpg"
  },
  "message": "å¤´åƒä¸Šä¼ æˆåŠŸ"
}
```

**è¯´æ˜:**
- æ”¯æŒæ ¼å¼: `jpeg`, `png`, `gif`, `webp`
- æœ€å¤§æ–‡ä»¶å¤§å°: 10MB
- ä¸Šä¼ æˆåŠŸåä¼šè‡ªåŠ¨æ›´æ–°ç”¨æˆ·çš„ `avatar` å­—æ®µ

---

## ğŸ¨ å‰ç«¯ä½¿ç”¨å»ºè®®

### ç”¨æˆ·èµ„æ–™é¡µé¢å¸ƒå±€å»ºè®®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ä¸ªäººèµ„æ–™è®¾ç½®               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  [å¤´åƒ]  displayName                â”‚
â”‚          @username                  â”‚
â”‚          email                      â”‚
â”‚                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  åŸºæœ¬ä¿¡æ¯:                          â”‚
â”‚  - æ˜µç§°: [è¾“å…¥æ¡†]                   â”‚
â”‚  - æ‰‹æœº: [è¾“å…¥æ¡†]                   â”‚
â”‚  - æ‰€åœ¨åœ°: [è¾“å…¥æ¡†]                 â”‚
â”‚                                     â”‚
â”‚  èŒä¸šä¿¡æ¯:                          â”‚
â”‚  - å…¬å¸: [è¾“å…¥æ¡†]                   â”‚
â”‚  - èŒä½: [è¾“å…¥æ¡†]                   â”‚
â”‚                                     â”‚
â”‚  ç¤¾äº¤ä¿¡æ¯:                          â”‚
â”‚  - ç½‘ç«™: [è¾“å…¥æ¡†]                   â”‚
â”‚                                     â”‚
â”‚  ä¸ªäººç®€ä»‹:                          â”‚
â”‚  [æ–‡æœ¬åŸŸ - æœ€å¤š500å­—]               â”‚
â”‚                                     â”‚
â”‚  è´¦å·ä¿¡æ¯:                          â”‚
â”‚  - æ³¨å†Œæ—¶é—´: createdAt              â”‚
â”‚  - æœ€åç™»å½•: lastLoginAt            â”‚
â”‚                                     â”‚
â”‚         [ä¿å­˜æ›´æ”¹] [å–æ¶ˆ]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¤´åƒæ˜¾ç¤ºé€»è¾‘

```typescript
// ç”¨æˆ·å¤´åƒæ˜¾ç¤º
function getUserAvatar(user) {
  return user.avatar || '/default-avatar.png';
}

// ç”¨æˆ·æ˜¾ç¤ºåç§°
function getUserDisplayName(user) {
  return user.displayName || user.username;
}
```

### è¡¨å•éªŒè¯

```typescript
const userProfileSchema = {
  displayName: {
    maxLength: 100,
    message: 'æ˜µç§°æœ€å¤š100ä¸ªå­—ç¬¦'
  },
  phone: {
    pattern: /^1[3-9]\d{9}$/,
    message: 'è¯·è¾“å…¥æœ‰æ•ˆçš„æ‰‹æœºå·'
  },
  bio: {
    maxLength: 500,
    message: 'ä¸ªäººç®€ä»‹æœ€å¤š500ä¸ªå­—ç¬¦'
  },
  website: {
    pattern: /^https?:\/\/.+/,
    message: 'è¯·è¾“å…¥æœ‰æ•ˆçš„ç½‘ç«™åœ°å€'
  }
};
```

---

## ğŸ“ æ•°æ®åº“è¿ç§»è¯´æ˜

å¯åŠ¨åº”ç”¨å,TypeORM ä¼šè‡ªåŠ¨åˆ›å»º/æ›´æ–°æ•°æ®åº“å­—æ®µ:
- âœ… è‡ªåŠ¨æ·»åŠ æ–°å­—æ®µ
- âœ… ç°æœ‰æ•°æ®ä¸å—å½±å“
- âœ… æ‰€æœ‰æ–°å­—æ®µéƒ½æ˜¯å¯é€‰çš„ (`nullable: true`)

å¦‚æœå‡ºç°å­—æ®µå†²çª,éœ€è¦æ‰‹åŠ¨åˆ é™¤æ—§å­—æ®µæˆ–é‡ç½®æ•°æ®åº“ã€‚

---

## ğŸ”’ å®‰å…¨æ³¨æ„äº‹é¡¹

1. **å¯†ç å­—æ®µ**: æ°¸è¿œä¸ä¼šè¿”å›ç»™å‰ç«¯
2. **refreshToken**: ä»…ç”¨äºåˆ·æ–°ä»¤ç‰Œ,ä¸è¿”å›ç»™å‰ç«¯
3. **å¤´åƒURL**: å­˜å‚¨åœ¨è…¾è®¯äº‘COS,å…¬å¼€å¯è®¿é—®
4. **ä¸ªäººä¿¡æ¯**: ä»…é™æœ¬äººæŸ¥çœ‹å’Œä¿®æ”¹

---

## ğŸ“± ç§»åŠ¨ç«¯é€‚é…

æ‰€æœ‰å­—æ®µéƒ½æ”¯æŒç§»åŠ¨ç«¯æ˜¾ç¤ºå’Œç¼–è¾‘,å»ºè®®:
- å¤´åƒæ”¯æŒç‚¹å‡»æ”¾å¤§æŸ¥çœ‹
- é•¿æ–‡æœ¬(bio)æ”¯æŒæŠ˜å æ˜¾ç¤º
- è¡¨å•é‡‡ç”¨åˆ†æ­¥å¡«å†™æ–¹å¼
- å›¾ç‰‡ä¸Šä¼ æ”¯æŒç›¸å†Œå’Œæ‹ç…§é€‰æ‹©
